#!/bin/sh
# Git wrapper for plugin socket system
#
# This script forwards git commands to the git-plugin container
# via Unix domain socket for secure, restricted execution.

SOCKET="/run/plugins/git.sock"
TOOL="git"
CLIENT="/home/claude/bin/plugin-client"

# Check if plugin socket exists
if [ ! -S "$SOCKET" ]; then
    echo "error: $TOOL plugin not available" >&2
    echo "hint: start the git-plugin container" >&2
    exit 127
fi

# Check if plugin-client exists
if [ ! -x "$CLIENT" ]; then
    # Fallback to PATH
    CLIENT="plugin-client"
fi

# Forward to plugin
exec "$CLIENT" "$SOCKET" "$@"
